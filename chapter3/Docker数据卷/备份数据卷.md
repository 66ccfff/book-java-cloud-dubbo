# 备份数据卷

---

这其实是利用 `tar` 命令来执行的。

备份的原理：创建一个数据卷容器，在创建一个引用数据卷容器的新容器，并设置数据卷为本地下的某个目录，并用 `tar -cvf` 命令对数据卷目录进行打压缩。

创建一个数据卷容器：

```
docker run -p 3306:3306 --name mysql \
-v /usr/local/docker/mysql/conf:/etc/mysql \
-v /usr/local/docker/mysql/logs:/var/log/mysql \
-v /usr/local/docker/mysql/data:/var/lib/mysql \
-e MYSQL_ROOT_PASSWORD=123456 \
-d mysql
```

创建一个新的容器并引用数据卷容器并备份新的容器：

```
docker run -d --name db1 \
--volumes-from mysql \
-v /usr/local/docker/mysql/backup:/backup \
ubuntu tar cvf /backup/backup.tar /var/lib/mysql
```

这里来解释一下，以后台的形式运行一个名为 db1 的容器，它是引用数据卷 mysql 的，所以在根下会有个 mysql 目录与 mysql 容器共享数据卷，而新的 db1 容器也关联了一个本地的数据卷，所以根下也会有一个 backup 目录，这里注意关联的必须是绝对路径

```
/usr/local/docker/mysql/backup:/backup
```

这里用一个冒号分割，冒号前的是本地的数据卷位置，是某个目录具体到那个目录，是文件具体到那个文件，冒号后是容器中根下的路径，比如 /usr/local/docker/mysql/backup:/test/backup，那么容器中根下的 test 目录下有 backup 目录，这个才是我们的数据卷。

运行完该命令后，我们会发现本地下多处一个 backup.tar 备份文件。

如果解压缩查看，可以使用 `tar xvf backup.tar` 命令